module TracksGrid


  # Basic filter
  #
  # scope = User.scoped
  #
  # f = Filter.new :active do |scope|
  #   scope.where( :status => 'active' )
  # end
  # 
  # f.apply( scope ) => scope.where( :status => 'active' )
  #
  class Filter

     attr_reader :name, :label

     def initialize( name, options ={}, &block )
       raise ArgumentError, "no block given" unless block
       @name, @options, @block = name, options, block
       @label = options[:label] || name
     end

     def apply( scope, value = nil )
       if value
         @block.call scope, value
       else
         @block.call scope
       end
     end

     def group( scope )
       { :total => count(scope) }
     end

  end
end
